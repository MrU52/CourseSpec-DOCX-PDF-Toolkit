<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>CourseSpec âŸ¡ DOCX Generator</title>


  <!-- Link to your external stylesheet -->
<link rel="stylesheet" href="/style.css" />


  <!-- Fonts & Libraries -->

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/ace.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/mode-json.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/theme-tomorrow_night_bright.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js" defer></script>

  
</head>

<body>
  <!-- JSON Input + DOCX Generation -->
  <div class="card" id="card">
    <h1><span>ğŸ“„</span> Generate DOCX from JSON</h1>
    <div id="editor">{ "CourseTitle": "GG", "CourseCode": "AYSM", "ContentTable": [ { "ContentTableTopic": "Intro to JS", "TopicHours": "2" } ] }</div>
    <button id="generateBtn"><span>ğŸš€</span> Generate DOCX</button>
    <div id="status"></div>
  </div>




  <!-- â¬‡ NEW compact upload card (900 px like the first) -->
<div class="card upload-card">
  <h1><span>ğŸ“¤</span> Convert DOCX to PDF</h1>

  <!-- Dropzone -->
  <div id="dropzone" class="dropzone">
    <p id="dzMessage">ğŸ“‚ Drop DOCX here / click to browse</p>
    <input type="file" id="fileInput" accept=".docx" hidden />
  </div>

  <!-- File info + circular progress -->
  <div class="file-row">
    <span id="fileInfo"></span>

    <svg id="progressCircle" class="circle hidden" width="48" height="48">
      <circle cx="24" cy="24" r="22" pathLength="100" />
      <text x="50%" y="50%" dy=".3em" text-anchor="middle" id="pctTxt">0%</text>
    </svg>
  </div>

  <button id="convertBtn" disabled>ğŸ“ Convert to PDF</button>
  <div id="upStatus"></div>
</div>





  <script>
    // Wait until libraries load
    window.addEventListener('load', () => {
      const editor = ace.edit("editor");
      editor.session.setMode("ace/mode/json");
      editor.setTheme("ace/theme/tomorrow_night_bright");
      editor.setOptions({ fontSize: "14px", wrap: true });
      gsap.from("#card", { opacity: 0, y: 60, duration: 1 });

      // Beautify the default JSON 
      const raw = editor.getValue();
      editor.setValue(JSON.stringify(JSON.parse(raw), null, 2), -1);

      
      // DOCX Generation Logic
      const btn = document.getElementById("generateBtn");
      const status = document.getElementById("status");
      btn.addEventListener("click", async () => {
        status.textContent = ""; status.className = "";
        let jsonData;
        try { jsonData = JSON.parse(editor.getValue()); } catch (e) {
          status.textContent = "âŒ Invalid JSON";
          status.classList.add("error");
          gsap.fromTo(status, { y: -5 }, { y: 0, duration: .2, repeat: 3, yoyo: true });
          return;
        }

        btn.disabled = true; btn.style.opacity = ".7"; btn.textContent = "â³ Generatingâ€¦";
        try {
          const res = await fetch(`${window.location.origin}/generate-docx`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ data: jsonData })
          });
          if (!res.ok) throw new Error("Server error");
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url; a.download = "course-spec.docx";
          document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
          status.textContent = "âœ… DOCX downloaded!"; status.classList.add("success");
          confetti({ particleCount: 100, spread: 70, origin: { y: 0.85 } });
        } catch (err) {
          status.textContent = "âŒ Failed to generate DOCX"; status.classList.add("error");
        } finally {
          btn.disabled = false; btn.style.opacity = "1"; btn.textContent = "ğŸš€ Generate DOCX";
        }
      });


      

      // PDF Upload Logic
 //  â”€â”€â”€ element refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const dz        = document.getElementById("dropzone");
const dzMsg     = document.getElementById("dzMessage");
const fileInput = document.getElementById("fileInput");
const convertBtn= document.getElementById("convertBtn");
const fileInfo  = document.getElementById("fileInfo");
const upStatus  = document.getElementById("upStatus");
const circle    = document.getElementById("progressCircle");
const pctTxt    = document.getElementById("pctTxt");
let selectedFile;

//  â”€â”€â”€ helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const setPct = p=>{
  circle.classList.remove("hidden");
  circle.querySelector("circle").style.strokeDashoffset = 100 - p;
  pctTxt.textContent = p + "%";
  if(p===100) setTimeout(()=>circle.classList.add("hidden"), 800);
}

//  â”€â”€â”€ drag / browse file selection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
dz.addEventListener("click", ()=>fileInput.click());
["dragover","dragenter"].forEach(eName=>
  dz.addEventListener(eName,e=>{e.preventDefault();dz.classList.add("dragover");})
);
["dragleave","drop"].forEach(eName=>
  dz.addEventListener(eName,()=>dz.classList.remove("dragover"))
);
dz.addEventListener("drop", e=>{
  e.preventDefault(); handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener("change", e=>handleFile(e.target.files[0]));

function handleFile(file){
  if(!file) return;
  selectedFile = file;
  fileInfo.textContent = `ğŸ“„ ${file.name} â€¢ ${(file.size/1024).toFixed(1)} KB`;
  convertBtn.disabled = false;
  setPct(0);
  upStatus.textContent="";
}

//  â”€â”€â”€ convert to PDF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
convertBtn.addEventListener("click", async ()=>{
  if(!selectedFile) return;
  const fd = new FormData(); fd.append("file", selectedFile);
  convertBtn.disabled = true; convertBtn.textContent="â³ Convertingâ€¦";
  setPct(10);                              // quick visual start

  try{
    const res = await fetch(`${window.location.origin}/upload`,{
      method:"POST", body: fd
    });
    if(!res.ok) throw new Error();

    // fake mid-progress animation (you donâ€™t stream upload progress)
    for(const p of [40,70,90,100]) setTimeout(()=>setPct(p), 120*(p/20));

    const blob = await res.blob();
    const url  = URL.createObjectURL(blob);
    setTimeout(()=>{ // ensure bar hits 100 before download dialog
      const a=document.createElement("a");
      a.href=url; a.download="converted.pdf";
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
      upStatus.textContent="âœ… PDF downloaded!"; upStatus.style.color="#16a34a";
    },500);

  }catch{
    upStatus.textContent="âŒ Conversion failed"; upStatus.style.color="#dc2626";
    circle.classList.add("hidden");
  }finally{
    convertBtn.disabled=false; convertBtn.textContent="ğŸ“ Convert to PDF";
  }
});


      const uploadForm = document.getElementById("uploadForm");
      const uploadBtn = document.getElementById("uploadBtn");
      const uploadStatus = document.getElementById("uploadStatus");
      uploadForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const file = uploadForm.querySelector("input[type=file]").files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append("file", file);
        uploadBtn.disabled = true;
        uploadBtn.textContent = "â³ Uploading...";
        uploadStatus.textContent = "";

        try {
          const res = await fetch(`${window.location.origin}/upload`, {
            method: "POST", body: formData
          });
          if (!res.ok) throw new Error("Conversion failed");
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url; a.download = "converted.pdf";
          document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
          uploadStatus.textContent = "âœ… PDF downloaded!";
          uploadStatus.style.color = "#16a34a";
        } catch (err) {
          uploadStatus.textContent = "âŒ Conversion failed";
          uploadStatus.style.color = "#dc2626";
        } finally {
          uploadBtn.disabled = false;
          uploadBtn.textContent = "ğŸ“ Upload & Convert";
        }
      });
    });
  </script>
</body>

</html>
