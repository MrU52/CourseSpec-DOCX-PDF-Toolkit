<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>CourseSpec ⟡ DOCX Generator</title>


  <!-- Link to your external stylesheet -->
<link rel="stylesheet" href="/style.css" />


  <!-- Fonts & Libraries -->

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/ace.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/mode-json.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/theme-tomorrow_night_bright.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js" defer></script>

  
</head>

<body>
  <!-- JSON Input + DOCX Generation -->
  <div class="card" id="card">
    <h1><span>📄</span> Generate DOCX from JSON</h1>
    <div id="editor">{ "CourseTitle": "GG", "CourseCode": "AYSM", "ContentTable": [ { "ContentTableTopic": "Intro to JS", "TopicHours": "2" } ] }</div>
    <button id="generateBtn"><span>🚀</span> Generate DOCX</button>
    <div id="status"></div>
  </div>


  <!-- ⬇⬇  NEW DRAG-AND-DROP UPLOAD AREA  ⬇⬇ -->
<div class="upload-card">
  <h1><span>📤</span> Convert DOCX to PDF</h1>

  <div id="dropzone" class="dropzone">
      <p id="dzMessage">📂 Drag & drop a DOCX here or click to browse</p>
      <input type="file" id="fileInput" accept=".docx" hidden />
  </div>

  <!-- file name / size -->
  <div id="fileInfo"></div>

  <!-- progress -->
  <div id="progressWrap" class="progress" hidden>
      <div id="progressBar" class="progress-bar"></div>
  </div>

  <button id="convertBtn" disabled style="margin-top:1.5rem;">📎 Convert to PDF</button>
  <div id="upStatus" style="margin-top:1rem;font-weight:600;"></div>
</div>



  <script>
    // Wait until libraries load
    window.addEventListener('load', () => {
      const editor = ace.edit("editor");
      editor.session.setMode("ace/mode/json");
      editor.setTheme("ace/theme/tomorrow_night_bright");
      editor.setOptions({ fontSize: "14px", wrap: true });
      gsap.from("#card", { opacity: 0, y: 60, duration: 1 });

      // Beautify the default JSON 
      const raw = editor.getValue();
      editor.setValue(JSON.stringify(JSON.parse(raw), null, 2), -1);

      
      // DOCX Generation Logic
      const btn = document.getElementById("generateBtn");
      const status = document.getElementById("status");
      btn.addEventListener("click", async () => {
        status.textContent = ""; status.className = "";
        let jsonData;
        try { jsonData = JSON.parse(editor.getValue()); } catch (e) {
          status.textContent = "❌ Invalid JSON";
          status.classList.add("error");
          gsap.fromTo(status, { y: -5 }, { y: 0, duration: .2, repeat: 3, yoyo: true });
          return;
        }

        btn.disabled = true; btn.style.opacity = ".7"; btn.textContent = "⏳ Generating…";
        try {
          const res = await fetch(`${window.location.origin}/generate-docx`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ data: jsonData })
          });
          if (!res.ok) throw new Error("Server error");
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url; a.download = "course-spec.docx";
          document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
          status.textContent = "✅ DOCX downloaded!"; status.classList.add("success");
          confetti({ particleCount: 100, spread: 70, origin: { y: 0.85 } });
        } catch (err) {
          status.textContent = "❌ Failed to generate DOCX"; status.classList.add("error");
        } finally {
          btn.disabled = false; btn.style.opacity = "1"; btn.textContent = "🚀 Generate DOCX";
        }
      });

      // PDF Upload Logic


      /* ----------  DRAG-AND-DROP LOGIC  ---------- */
const dz        = document.getElementById("dropzone");
const dzMsg     = document.getElementById("dzMessage");
const fileInput = document.getElementById("fileInput");
const convertBtn= document.getElementById("convertBtn");
const upStatus  = document.getElementById("upStatus");
const pWrap     = document.getElementById("progressWrap");
const pBar      = document.getElementById("progressBar");
const fileInfo   = document.getElementById("fileInfo");
let selectedFile;

/* helpers */
const resetUI = () => {
  pWrap.hidden = true; pBar.style.width="0%";
  convertBtn.disabled = true; upStatus.textContent = "";
};

dz.addEventListener("click", ()=> fileInput.click());

["dragover","dragenter"].forEach(evt =>
  dz.addEventListener(evt,e=>{ e.preventDefault(); dz.classList.add("dragover");})
);
["dragleave","drop"].forEach(evt =>
  dz.addEventListener(evt,()=> dz.classList.remove("dragover"))
);

dz.addEventListener("drop", e=>{
  e.preventDefault();
  fileInput.files = e.dataTransfer.files;
  handleFile(fileInput.files[0]);
});
fileInput.addEventListener("change", e=> handleFile(e.target.files[0]));

function handleFile(file){
  if(!file) return;             // guard
  selectedFile = file;
  dzMsg.textContent = `📄 ${file.name}`;
  convertBtn.disabled = false;
  pWrap.hidden = true; pBar.style.width="0%";
  fileInfo.textContent = `📄 ${file.name}
  ${(file.size/1024).toFixed(1)} KB`;
}

/* ----------  CONVERT BUTTON  ---------- */
convertBtn.addEventListener("click", async ()=>{
  if(!selectedFile) return;
  const formData = new FormData();
  formData.append("file", selectedFile);

  // UI → busy
  convertBtn.disabled = true;
  convertBtn.textContent = "⏳ Converting…";
  upStatus.textContent = "";
  pWrap.hidden = false;

  try{
    const res = await fetch(`${window.location.origin}/upload`, {
      method:"POST", body: formData
    });
    if(!res.ok) throw new Error("Conversion failed");

    pBar.style.width = "100%";
fileInfo.classList.add("flash-success");
setTimeout(()=>fileInfo.classList.remove("flash-success"),800);

    const blob = await res.blob();
    const url  = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "converted.pdf";
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);

    upStatus.style.color = "#16a34a";
    upStatus.textContent = "✅ PDF downloaded!";
  }catch(err){
    upStatus.style.color = "#dc2626";
    upStatus.textContent = "❌ Conversion failed";
  }finally{
    convertBtn.disabled = false;
    convertBtn.textContent = "📎 Convert to PDF";
  }
});

      const uploadForm = document.getElementById("uploadForm");
      const uploadBtn = document.getElementById("uploadBtn");
      const uploadStatus = document.getElementById("uploadStatus");
      uploadForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const file = uploadForm.querySelector("input[type=file]").files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append("file", file);
        uploadBtn.disabled = true;
        uploadBtn.textContent = "⏳ Uploading...";
        uploadStatus.textContent = "";

        try {
          const res = await fetch(`${window.location.origin}/upload`, {
            method: "POST", body: formData
          });
          if (!res.ok) throw new Error("Conversion failed");
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url; a.download = "converted.pdf";
          document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
          uploadStatus.textContent = "✅ PDF downloaded!";
          uploadStatus.style.color = "#16a34a";
        } catch (err) {
          uploadStatus.textContent = "❌ Conversion failed";
          uploadStatus.style.color = "#dc2626";
        } finally {
          uploadBtn.disabled = false;
          uploadBtn.textContent = "📎 Upload & Convert";
        }
      });
    });
  </script>
</body>

</html>
